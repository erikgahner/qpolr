<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Quantitative Politics with R</title>
  <meta name="description" content="Quantitative Politics with R">
  <meta name="generator" content="bookdown 0.6 and GitBook 2.6.7">

  <meta property="og:title" content="Quantitative Politics with R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Quantitative Politics with R" />
  
  
  

<meta name="author" content="Erik Gahner Larsen and Zoltán Fazekas">


<meta name="date" content="2018-02-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="2-basics.html">
<link rel="next" href="4-dataviz.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-r"><i class="fa fa-check"></i><b>1.2</b> Installing <code>R</code></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installing-r-packages"><i class="fa fa-check"></i><b>1.4</b> Installing <code>R</code> packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#errors-and-help"><i class="fa fa-check"></i><b>1.5</b> Errors and help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-basics.html"><a href="2-basics.html"><i class="fa fa-check"></i><b>2</b> Basics</a><ul>
<li class="chapter" data-level="2.1" data-path="2-basics.html"><a href="2-basics.html#numbers-as-data"><i class="fa fa-check"></i><b>2.1</b> Numbers as data</a></li>
<li class="chapter" data-level="2.2" data-path="2-basics.html"><a href="2-basics.html#missing-values-na"><i class="fa fa-check"></i><b>2.2</b> Missing values (<code>NA</code>)</a></li>
<li class="chapter" data-level="2.3" data-path="2-basics.html"><a href="2-basics.html#logical-operators"><i class="fa fa-check"></i><b>2.3</b> Logical operators</a></li>
<li class="chapter" data-level="2.4" data-path="2-basics.html"><a href="2-basics.html#text-as-data"><i class="fa fa-check"></i><b>2.4</b> Text as data</a></li>
<li class="chapter" data-level="2.5" data-path="2-basics.html"><a href="2-basics.html#data-frames"><i class="fa fa-check"></i><b>2.5</b> Data frames</a></li>
<li class="chapter" data-level="2.6" data-path="2-basics.html"><a href="2-basics.html#import-and-export-data-frames"><i class="fa fa-check"></i><b>2.6</b> Import and export data frames</a></li>
<li class="chapter" data-level="2.7" data-path="2-basics.html"><a href="2-basics.html#environment"><i class="fa fa-check"></i><b>2.7</b> Environment</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-data.html"><a href="3-data.html"><i class="fa fa-check"></i><b>3</b> Data management</a><ul>
<li class="chapter" data-level="3.1" data-path="3-data.html"><a href="3-data.html#selecting-variables-select"><i class="fa fa-check"></i><b>3.1</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="3.2" data-path="3-data.html"><a href="3-data.html#selecting-observations-filter"><i class="fa fa-check"></i><b>3.2</b> Selecting observations: <code>filter()</code></a></li>
<li class="chapter" data-level="3.3" data-path="3-data.html"><a href="3-data.html#sorting-observations-arrange"><i class="fa fa-check"></i><b>3.3</b> Sorting observations: <code>arrange()</code></a></li>
<li class="chapter" data-level="3.4" data-path="3-data.html"><a href="3-data.html#rename-variables-rename"><i class="fa fa-check"></i><b>3.4</b> Rename variables: <code>rename()</code></a></li>
<li class="chapter" data-level="3.5" data-path="3-data.html"><a href="3-data.html#create-variables-mutate"><i class="fa fa-check"></i><b>3.5</b> Create variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="3.6" data-path="3-data.html"><a href="3-data.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.6</b> The pipe operator: <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.7" data-path="3-data.html"><a href="3-data.html#running-functions-on-variables-apply"><i class="fa fa-check"></i><b>3.7</b> Running functions on variables: <code>apply()</code></a></li>
<li class="chapter" data-level="3.8" data-path="3-data.html"><a href="3-data.html#aggregating-variables-summarize-and-group_by"><i class="fa fa-check"></i><b>3.8</b> Aggregating variables: <code>summarize()</code> and <code>group_by()</code></a></li>
<li class="chapter" data-level="3.9" data-path="3-data.html"><a href="3-data.html#recoding-variables-recode"><i class="fa fa-check"></i><b>3.9</b> Recoding variables: <code>recode()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-dataviz.html"><a href="4-dataviz.html"><i class="fa fa-check"></i><b>4</b> Data visualisation</a><ul>
<li class="chapter" data-level="4.1" data-path="4-dataviz.html"><a href="4-dataviz.html#the-basics-of-ggplot2"><i class="fa fa-check"></i><b>4.1</b> The basics of <code>ggplot2</code></a><ul>
<li class="chapter" data-level="4.1.1" data-path="3-data.html"><a href="3-data.html#data"><i class="fa fa-check"></i><b>4.1.1</b> Data</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-dataviz.html"><a href="4-dataviz.html#aesthetics"><i class="fa fa-check"></i><b>4.1.2</b> Aesthetics</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-dataviz.html"><a href="4-dataviz.html#geometric-objects"><i class="fa fa-check"></i><b>4.1.3</b> Geometric objects</a></li>
<li class="chapter" data-level="4.1.4" data-path="4-dataviz.html"><a href="4-dataviz.html#theme-adjustments"><i class="fa fa-check"></i><b>4.1.4</b> Theme adjustments</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-dataviz.html"><a href="4-dataviz.html#introducing-the-data-ess_uk.csv"><i class="fa fa-check"></i><b>4.2</b> Introducing the data: <code>ess_uk.csv</code></a></li>
<li class="chapter" data-level="4.3" data-path="4-dataviz.html"><a href="4-dataviz.html#plotting-one-variable-distributions"><i class="fa fa-check"></i><b>4.3</b> Plotting one variable: distributions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="4-dataviz.html"><a href="4-dataviz.html#bar-plot"><i class="fa fa-check"></i><b>4.3.1</b> Bar plot</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-dataviz.html"><a href="4-dataviz.html#histograms"><i class="fa fa-check"></i><b>4.3.2</b> Histograms</a></li>
<li class="chapter" data-level="4.3.3" data-path="4-dataviz.html"><a href="4-dataviz.html#density-plots"><i class="fa fa-check"></i><b>4.3.3</b> Density plots</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-dataviz.html"><a href="4-dataviz.html#plotting-two-variables-relationships"><i class="fa fa-check"></i><b>4.4</b> Plotting two variables: relationships</a><ul>
<li class="chapter" data-level="4.4.1" data-path="4-dataviz.html"><a href="4-dataviz.html#box-plot"><i class="fa fa-check"></i><b>4.4.1</b> Box plot</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-dataviz.html"><a href="4-dataviz.html#scatter-plots"><i class="fa fa-check"></i><b>4.4.2</b> Scatter plots</a></li>
<li class="chapter" data-level="4.4.3" data-path="4-dataviz.html"><a href="4-dataviz.html#line-plots"><i class="fa fa-check"></i><b>4.4.3</b> Line plots</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="4-dataviz.html"><a href="4-dataviz.html#manipulating-plots"><i class="fa fa-check"></i><b>4.5</b> Manipulating plots</a><ul>
<li class="chapter" data-level="4.5.1" data-path="4-dataviz.html"><a href="4-dataviz.html#themes"><i class="fa fa-check"></i><b>4.5.1</b> Themes</a></li>
<li class="chapter" data-level="4.5.2" data-path="4-dataviz.html"><a href="4-dataviz.html#colours"><i class="fa fa-check"></i><b>4.5.2</b> Colours</a></li>
<li class="chapter" data-level="4.5.3" data-path="4-dataviz.html"><a href="4-dataviz.html#labels"><i class="fa fa-check"></i><b>4.5.3</b> Labels</a></li>
<li class="chapter" data-level="4.5.4" data-path="4-dataviz.html"><a href="4-dataviz.html#axes"><i class="fa fa-check"></i><b>4.5.4</b> Axes</a></li>
<li class="chapter" data-level="4.5.5" data-path="4-dataviz.html"><a href="4-dataviz.html#confidence-intervals"><i class="fa fa-check"></i><b>4.5.5</b> Confidence intervals</a></li>
<li class="chapter" data-level="4.5.6" data-path="4-dataviz.html"><a href="4-dataviz.html#making-multiple-plots-in-one"><i class="fa fa-check"></i><b>4.5.6</b> Making multiple plots in one</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="4-dataviz.html"><a href="4-dataviz.html#saving-plots"><i class="fa fa-check"></i><b>4.6</b> Saving plots</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-references.html"><a href="5-references.html"><i class="fa fa-check"></i><b>5</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Politics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data management</h1>
<p>There are multiple ways to manage data in <code>R</code> and in particular ways to create and change variables in a data frame. In this chapter, we show different ways of working with data frames with a focus on how to change variables. Noteworthy, there are multiple packages we can use to manipulate data farmes, but the best is without a doubt <code>dplyr</code> <span class="citation">(Hadley Wickham &amp; Francois, 2016)</span>.</p>
<p>The package provides some basic functions making it easy to work with data frames. These functions include <code>select()</code>, <code>filter()</code>, <code>arrange()</code>, <code>rename()</code>, <code>mutate()</code> og <code>summarize()</code>.<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a> <code>select()</code> allows you to pick variables by their names. <code>filter()</code> allows you to pick observations by their values. <code>arrange()</code> allows you to reorder the rows. <code>rename()</code> allows you to rename columns. <code>mutate()</code> allows you to create new variables based on the values of old variables. <code>summarize()</code> allows you to collapse many values to a single summary.</p>
<p>All these functions rely on data frames. In other words, you can not use these functions on other types of data in <code>R</code>. Furthermore, they all return a new data frame.</p>
<p>The <code>dplyr</code> package is a part of the <code>tidyverse</code>. First, load the <code>tidyverse</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>We will use the dataset we created in the previous chapter. If you do not have it, you can download it here: <a href="http://qpolr.com/data/uk2017.csv" class="uri">http://qpolr.com/data/uk2017.csv</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;uk2017.csv&quot;</span>)</code></pre></div>
<p>To see the information in the dataset, use <code>head()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(uk2017)</code></pre></div>
<pre><code>                      party          leader votes seats seats_change
1        Conservative Party     Theresa May  42.4   317          -13
2              Labour Party   Jeremy Corbyn  40.0   262           30
3   Scottish National Party Nicola Sturgeon   3.0    35          -21
4         Liberal Democrats      Tim Farron   7.4    12            4
5 Democratic Unionist Party   Arlene Foster   0.9    10            2
6                 Sinn Féin     Gerry Adams   0.7     7            3</code></pre>
<div id="selecting-variables-select" class="section level2">
<h2><span class="header-section-number">3.1</span> Selecting variables: <code>select()</code></h2>
<p>When we work with large datasets, we often want to select the few variables that are of key interest to our project. For this, the <code>select()</code> function is perfect. If we only want to have information on the party name and the votes in the <code>uk2017</code> data frame, we can write:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(uk2017, party, votes)</code></pre></div>
<pre><code>                      party votes
1        Conservative Party  42.4
2              Labour Party  40.0
3   Scottish National Party   3.0
4         Liberal Democrats   7.4
5 Democratic Unionist Party   0.9
6                 Sinn Féin   0.7</code></pre>
<p>There are multiple different functions that can help us finding specific variables in the data frame. We can use <code>contains()</code>, if we want to include variables that contain a specific word in the variable name. In the example below we look for variables that contain <code>seat</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(uk2017, <span class="kw">contains</span>(<span class="st">&quot;seat&quot;</span>))</code></pre></div>
<pre><code>  seats seats_change
1   317          -13
2   262           30
3    35          -21
4    12            4
5    10            2
6     7            3</code></pre>
<p>Other noteworthy functions that can be of help similar to <code>contains()</code> are functions such as <code>starts_with()</code>, <code>ends_with()</code>, <code>matches()</code>, <code>num_range()</code>, <code>one_of()</code> and <code>everything()</code>. The last function, <code>everything()</code> is helpful if we want to move a variable to the beginning of our data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(uk2017, votes, <span class="kw">everything</span>())</code></pre></div>
<pre><code>  votes                     party          leader seats seats_change
1  42.4        Conservative Party     Theresa May   317          -13
2  40.0              Labour Party   Jeremy Corbyn   262           30
3   3.0   Scottish National Party Nicola Sturgeon    35          -21
4   7.4         Liberal Democrats      Tim Farron    12            4
5   0.9 Democratic Unionist Party   Arlene Foster    10            2
6   0.7                 Sinn Féin     Gerry Adams     7            3</code></pre>
<p>We can use the negative sign if we want to remove a variable from the data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(uk2017, <span class="op">-</span>leader)</code></pre></div>
<pre><code>                      party votes seats seats_change
1        Conservative Party  42.4   317          -13
2              Labour Party  40.0   262           30
3   Scottish National Party   3.0    35          -21
4         Liberal Democrats   7.4    12            4
5 Democratic Unionist Party   0.9    10            2
6                 Sinn Féin   0.7     7            3</code></pre>
</div>
<div id="selecting-observations-filter" class="section level2">
<h2><span class="header-section-number">3.2</span> Selecting observations: <code>filter()</code></h2>
<p>To select only some of the observations in our data frame, but for all variables, we can use the function <code>filter()</code>. In the example below we select the observations in our data frame with a positive value on <code>seats_change</code> (i.e. greater than 0).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(uk2017, seats_change <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>                      party        leader votes seats seats_change
1              Labour Party Jeremy Corbyn  40.0   262           30
2         Liberal Democrats    Tim Farron   7.4    12            4
3 Democratic Unionist Party Arlene Foster   0.9    10            2
4                 Sinn Féin   Gerry Adams   0.7     7            3</code></pre>
<p>Importantly, we are <em>not</em> making any changes to the data frame <code>uk2017</code>. This will only hapen if we replace our existing data frame or create a new data frame. In the example below we create a new data frame, <code>uk2017_seatlosers</code>, with the observations losing seats from 2015 to 2017.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017_seatlosers &lt;-<span class="st"> </span><span class="kw">filter</span>(uk2017, seats_change <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)
uk2017_seatlosers</code></pre></div>
<pre><code>                    party          leader votes seats seats_change
1      Conservative Party     Theresa May  42.4   317          -13
2 Scottish National Party Nicola Sturgeon   3.0    35          -21</code></pre>
<p>Last, if we want to drop observations that contain missing values on specific variables, we can use the function <code>drop_na()</code>.</p>
</div>
<div id="sorting-observations-arrange" class="section level2">
<h2><span class="header-section-number">3.3</span> Sorting observations: <code>arrange()</code></h2>
<p>We can use the function <code>arrange()</code> if we want to change the order of observations. In the example below we sort our data frame according to how many votes the party got, with the party getting the least votes in the top of our data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(uk2017, votes)</code></pre></div>
<pre><code>                      party          leader votes seats seats_change
1                 Sinn Féin     Gerry Adams   0.7     7            3
2 Democratic Unionist Party   Arlene Foster   0.9    10            2
3   Scottish National Party Nicola Sturgeon   3.0    35          -21
4         Liberal Democrats      Tim Farron   7.4    12            4
5              Labour Party   Jeremy Corbyn  40.0   262           30
6        Conservative Party     Theresa May  42.4   317          -13</code></pre>
<p>If we prefer to have the parties with the maximum number of votes in the top, we can use the negative sign (<code>-</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(uk2017, <span class="op">-</span>votes)</code></pre></div>
<pre><code>                      party          leader votes seats seats_change
1        Conservative Party     Theresa May  42.4   317          -13
2              Labour Party   Jeremy Corbyn  40.0   262           30
3         Liberal Democrats      Tim Farron   7.4    12            4
4   Scottish National Party Nicola Sturgeon   3.0    35          -21
5 Democratic Unionist Party   Arlene Foster   0.9    10            2
6                 Sinn Féin     Gerry Adams   0.7     7            3</code></pre>
</div>
<div id="rename-variables-rename" class="section level2">
<h2><span class="header-section-number">3.4</span> Rename variables: <code>rename()</code></h2>
<p>In the case we have a variable we would prefer having another name, we can use the function <code>rename()</code>. In the example below we change the name of <code>party</code> to <code>party_name</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rename</span>(uk2017, <span class="dt">party_name =</span> party)</code></pre></div>
<pre><code>                 party_name          leader votes seats seats_change
1        Conservative Party     Theresa May  42.4   317          -13
2              Labour Party   Jeremy Corbyn  40.0   262           30
3   Scottish National Party Nicola Sturgeon   3.0    35          -21
4         Liberal Democrats      Tim Farron   7.4    12            4
5 Democratic Unionist Party   Arlene Foster   0.9    10            2
6                 Sinn Féin     Gerry Adams   0.7     7            3</code></pre>
</div>
<div id="create-variables-mutate" class="section level2">
<h2><span class="header-section-number">3.5</span> Create variables: <code>mutate()</code></h2>
<p>The best way to create a new variable from existing variables in our data frame is to use the function <code>mutate()</code>. In the example below we create a new variable, <code>votes_m</code> with information on how many percentage points a party is from the average number of votes a party got.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(uk2017, <span class="dt">votes_m =</span> votes <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(votes))</code></pre></div>
<pre><code>                      party          leader votes seats seats_change
1        Conservative Party     Theresa May  42.4   317          -13
2              Labour Party   Jeremy Corbyn  40.0   262           30
3   Scottish National Party Nicola Sturgeon   3.0    35          -21
4         Liberal Democrats      Tim Farron   7.4    12            4
5 Democratic Unionist Party   Arlene Foster   0.9    10            2
6                 Sinn Féin     Gerry Adams   0.7     7            3
     votes_m
1  26.666667
2  24.266667
3 -12.733333
4  -8.333333
5 -14.833333
6 -15.033333</code></pre>
<p>In another example we use the <code>sum()</code> function as well to find the proportion of seats a party got in a variable, <code>seats_prop</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(uk2017, <span class="dt">seats_prop =</span> seats <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(seats))</code></pre></div>
<pre><code>                      party          leader votes seats seats_change
1        Conservative Party     Theresa May  42.4   317          -13
2              Labour Party   Jeremy Corbyn  40.0   262           30
3   Scottish National Party Nicola Sturgeon   3.0    35          -21
4         Liberal Democrats      Tim Farron   7.4    12            4
5 Democratic Unionist Party   Arlene Foster   0.9    10            2
6                 Sinn Féin     Gerry Adams   0.7     7            3
  seats_prop
1 0.49300156
2 0.40746501
3 0.05443235
4 0.01866252
5 0.01555210
6 0.01088647</code></pre>
</div>
<div id="the-pipe-operator" class="section level2">
<h2><span class="header-section-number">3.6</span> The pipe operator: <code>%&gt;%</code></h2>
<p>So far we have looked at a series of different functions. In most cases we want to combine these functions, e.g. when we both have to select specific variables and observations. Luckikly, there is nothing against using one function nested within another, as the example below shows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(<span class="kw">select</span>(uk2017, party, votes), seats_change <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>                      party votes
1              Labour Party  40.0
2         Liberal Democrats   7.4
3 Democratic Unionist Party   0.9
4                 Sinn Féin   0.7</code></pre>
<p>The problem is that it can be complicated to read, especially when as the number of functions we use increase. Furthermore, the likelihood of making a stupid mistake, e.g. by including an extra <code>(</code> or <code>)</code> increases substantially. Luckily, we can use the pipe operator, <code>%&gt;%</code>, to make our code more readable.</p>
<p>The operator relies on a step-wise logic so we first specify the data frame and then a line for each function we want to run on the data frame.</p>
<p>In the example below we do the same as above but in a way that is easier to follow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(party, votes) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(seats_change <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>                      party votes
1              Labour Party  40.0
2         Liberal Democrats   7.4
3 Democratic Unionist Party   0.9
4                 Sinn Féin   0.7</code></pre>
<p>On the first line, we show that we are using the data frame <code>uk2017</code>. We end this line with <code>%&gt;%</code>, telling <code>R</code> that we are not done yet but will have to put this into the function on the line below. The next line uses the input from the previous line and selects <code>party</code> and <code>votes</code> from the data frame. This line also ends with the pipe, <code>%&gt;%</code>. The third line shows the observations in our data frame where <code>seats_change</code> is greater than 0. Note that we did not select <code>seats_change</code> as a variable with <code>select()</code>, so this is not crucial in order to use it (as long as it is in the <code>uk2017</code> data frame). Last, we do <em>not</em> end with a pipe as we are now done.</p>
</div>
<div id="running-functions-on-variables-apply" class="section level2">
<h2><span class="header-section-number">3.7</span> Running functions on variables: <code>apply()</code></h2>
<p>If we would like to run a function on some of our rows or columns we can use the function <code>apply()</code>. For example, we can get the average number of votes and seats for parties with a positive value on <code>seats_change</code> (i.e. parties with an increase in seats from 2015 to 2017.</p>
<p>The addition here is the function <code>apply()</code> on the data frame used above. The first thing we specify here is <code>MARGIN</code>, i.e. whether we want to run a function on our rows (1) or columns (2). The next thing we specify is the function together with any relevant options.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(seats_change <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(votes, seats) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">apply</span>(<span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>votes seats 
12.25 72.75 </code></pre>
<p>In the case you want to apply a function to both rows and columns, you will have to specify <code>c(1, 2)</code>. It is not important to mention <code>MARGIN</code> eller <code>FUN</code> if you have the order right. In other words, we can simplify our example to the code below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(seats_change <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(votes, seats) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">apply</span>(<span class="dv">2</span>, mean)</code></pre></div>
<pre><code>votes seats 
12.25 72.75 </code></pre>
</div>
<div id="aggregating-variables-summarize-and-group_by" class="section level2">
<h2><span class="header-section-number">3.8</span> Aggregating variables: <code>summarize()</code> and <code>group_by()</code></h2>
<p>If we want to create new variables with aggregated information, similar to the information we got in the previous section, we can use the function <code>summarize()</code>. In the example below we get a data frame with information on the number of observatins, given by <code>n()</code>, the minimum number of votes a party got (<code>votes_min</code>), the maximum number of votes a party got (<code>votes_max</code>) and the average number of votes a party got (<code>votes_mean</code>) (all in percentages).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">party =</span> <span class="kw">n</span>(), 
            <span class="dt">votes_min =</span> <span class="kw">min</span>(votes), 
            <span class="dt">votes_max =</span> <span class="kw">max</span>(votes), 
            <span class="dt">votes_mean =</span> <span class="kw">mean</span>(votes))</code></pre></div>
<pre><code>  party votes_min votes_max votes_mean
1     6       0.7      42.4   15.73333</code></pre>
<p>If we want this information for different groups, we can supply with <code>group_by()</code>. In the example below we will like to have the information both for parties with an increase in seats from 2015 to 2017 and not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(seats_change <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">party =</span> <span class="kw">n</span>(), 
            <span class="dt">votes_min =</span> <span class="kw">min</span>(votes), 
            <span class="dt">votes_max =</span> <span class="kw">max</span>(votes), 
            <span class="dt">votes_mean =</span> <span class="kw">mean</span>(votes))</code></pre></div>
<pre><code># A tibble: 2 x 5
  `seats_change &gt; 0` party votes_min votes_max votes_mean
  &lt;lgl&gt;              &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 F                      2     3.00       42.4       22.7
2 T                      4     0.700      40.0       12.2</code></pre>
<p>In the example, you can see the aggregated information. <code>T</code> is short for <code>TRUE</code> and is the aggregated information for the observations where <code>seats_change</code> is greater than 0.</p>
</div>
<div id="recoding-variables-recode" class="section level2">
<h2><span class="header-section-number">3.9</span> Recoding variables: <code>recode()</code></h2>
<p>In a lot of cases we want to recode the information in a single variable. To do this, we can use <code>recode()</code>. Importantly, this function works for individual variables and not for a data frame. Let us use the <code>leader</code> variable in <code>uk2017</code> as an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017<span class="op">$</span>leader </code></pre></div>
<pre><code>[1] Theresa May     Jeremy Corbyn   Nicola Sturgeon Tim Farron     
[5] Arlene Foster   Gerry Adams    
6 Levels: Arlene Foster Gerry Adams Jeremy Corbyn ... Tim Farron</code></pre>
<p>In the case that we want to replace Tim Farron in the variable with a new guy, we can do that with the code below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(uk2017<span class="op">$</span>leader, <span class="st">&quot;Tim Farron&quot;</span> =<span class="st"> &quot;New guy&quot;</span>)</code></pre></div>
<pre><code>[1] Theresa May     Jeremy Corbyn   Nicola Sturgeon New guy        
[5] Arlene Foster   Gerry Adams    
6 Levels: Arlene Foster Gerry Adams Jeremy Corbyn ... New guy</code></pre>
<p>Noteworthy, we do not create any changes to the <code>leader</code> variable. If we want to save the changes, we can save the new variable to our data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2017<span class="op">$</span>leader_new &lt;-<span class="st"> </span><span class="kw">recode</span>(uk2017<span class="op">$</span>leader, <span class="st">&quot;Tim Farron&quot;</span> =<span class="st"> &quot;New guy&quot;</span>)

uk2017<span class="op">$</span>leader_new</code></pre></div>
<pre><code>[1] Theresa May     Jeremy Corbyn   Nicola Sturgeon New guy        
[5] Arlene Foster   Gerry Adams    
6 Levels: Arlene Foster Gerry Adams Jeremy Corbyn ... New guy</code></pre>
<p>Last, <code>dplyr</code> in the <code>tidyverse</code> is not the only package with a <code>recode()</code> function. The package <code>car</code> <span class="citation">(Fox &amp; Weisberg, 2011)</span> has a similar function worth exploring.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p>For another good introduction to <code>dplyr</code>, see: <a href="https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html">Managing Data Frames with the dplyr package</a>.<a href="3-data.html#fnref7">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="2-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="4-dataviz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": [["qpolr.pdf", "PDF"], ["qpolr.epub", "EPUB"], ["qpolr.docx", "Word"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

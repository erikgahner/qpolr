<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data management | Quantitative Politics with R</title>
  <meta name="description" content="Chapter 3 Data management | Quantitative Politics with R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data management | Quantitative Politics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://qpolr.com" />
  
  
  <meta name="github-repo" content="erikgahner/qpolr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data management | Quantitative Politics with R" />
  
  
  

<meta name="author" content="Erik Gahner Larsen and ZoltÃ¡n Fazekas" />


<meta name="date" content="2021-04-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basics.html"/>
<link rel="next" href="text.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-r"><i class="fa fa-check"></i><b>1.2</b> Installing <code>R</code></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installing-r-packages"><i class="fa fa-check"></i><b>1.4</b> Installing <code>R</code> packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#problems-and-help"><i class="fa fa-check"></i><b>1.5</b> Problems and help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#numbers-as-data"><i class="fa fa-check"></i><b>2.1</b> Numbers as data</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#missing-values-na"><i class="fa fa-check"></i><b>2.2</b> Missing values (<code>NA</code>)</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#logical-operators"><i class="fa fa-check"></i><b>2.3</b> Logical operators</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#text-as-data"><i class="fa fa-check"></i><b>2.4</b> Text as data</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#repetition-and-sequence"><i class="fa fa-check"></i><b>2.5</b> Repetition and sequence</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#data-frames"><i class="fa fa-check"></i><b>2.6</b> Data frames</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#import-and-export-data-frames"><i class="fa fa-check"></i><b>2.7</b> Import and export data frames</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#environment"><i class="fa fa-check"></i><b>2.8</b> Environment</a></li>
</ul></li>
<li class="part"><span><b>I Working with data</b></span></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data management</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#selecting-variables-select"><i class="fa fa-check"></i><b>3.1</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#selecting-observations-filter"><i class="fa fa-check"></i><b>3.2</b> Selecting observations: <code>filter()</code></a></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#sorting-observations-arrange"><i class="fa fa-check"></i><b>3.3</b> Sorting observations: <code>arrange()</code></a></li>
<li class="chapter" data-level="3.4" data-path="data.html"><a href="data.html#rename-variables-rename"><i class="fa fa-check"></i><b>3.4</b> Rename variables: <code>rename()</code></a></li>
<li class="chapter" data-level="3.5" data-path="data.html"><a href="data.html#create-variables-mutate"><i class="fa fa-check"></i><b>3.5</b> Create variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="3.6" data-path="data.html"><a href="data.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.6</b> The pipe operator: <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.7" data-path="data.html"><a href="data.html#running-functions-on-variables-apply"><i class="fa fa-check"></i><b>3.7</b> Running functions on variables: <code>apply()</code></a></li>
<li class="chapter" data-level="3.8" data-path="data.html"><a href="data.html#aggregating-variables-summarize-and-group_by"><i class="fa fa-check"></i><b>3.8</b> Aggregating variables: <code>summarize()</code> and <code>group_by()</code></a></li>
<li class="chapter" data-level="3.9" data-path="data.html"><a href="data.html#recoding-variables-case_when"><i class="fa fa-check"></i><b>3.9</b> Recoding variables: <code>case_when()</code></a></li>
<li class="chapter" data-level="3.10" data-path="data.html"><a href="data.html#choosing-rows-by-position-slice"><i class="fa fa-check"></i><b>3.10</b> Choosing rows by position: <code>slice()</code></a></li>
<li class="chapter" data-level="3.11" data-path="data.html"><a href="data.html#getting-a-variable-from-a-data-frame-pull"><i class="fa fa-check"></i><b>3.11</b> Getting a variable from a data frame: <code>pull()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="text.html"><a href="text.html"><i class="fa fa-check"></i><b>4</b> Manipulating text</a>
<ul>
<li class="chapter" data-level="4.1" data-path="text.html"><a href="text.html#strings"><i class="fa fa-check"></i><b>4.1</b> Strings</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="text.html"><a href="text.html#regular-expression-regex"><i class="fa fa-check"></i><b>4.1.1</b> Regular expression (regex)</a></li>
<li class="chapter" data-level="4.1.2" data-path="text.html"><a href="text.html#changing-the-case-of-strings"><i class="fa fa-check"></i><b>4.1.2</b> Changing the case of strings</a></li>
<li class="chapter" data-level="4.1.3" data-path="text.html"><a href="text.html#subset-and-mutate-strings"><i class="fa fa-check"></i><b>4.1.3</b> Subset and mutate strings</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="text.html"><a href="text.html#factors"><i class="fa fa-check"></i><b>4.2</b> Factors</a></li>
<li class="chapter" data-level="4.3" data-path="text.html"><a href="text.html#dates-and-time"><i class="fa fa-check"></i><b>4.3</b> Dates and time</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datadownload.html"><a href="datadownload.html"><i class="fa fa-check"></i><b>5</b> Get existing data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="datadownload.html"><a href="datadownload.html#using-data-from-data-packages"><i class="fa fa-check"></i><b>5.1</b> Using data from data packages</a></li>
<li class="chapter" data-level="5.2" data-path="datadownload.html"><a href="datadownload.html#download-data-from-webpages"><i class="fa fa-check"></i><b>5.2</b> Download data from webpages</a></li>
<li class="chapter" data-level="5.3" data-path="datadownload.html"><a href="datadownload.html#data-european-social-survey-essurvey"><i class="fa fa-check"></i><b>5.3</b> Data: European Social Survey (<code>essurvey</code>)</a></li>
<li class="chapter" data-level="5.4" data-path="datadownload.html"><a href="datadownload.html#data-general-social-survey-gssr"><i class="fa fa-check"></i><b>5.4</b> Data: General Social Survey (<code>gssr</code>)</a></li>
<li class="chapter" data-level="5.5" data-path="datadownload.html"><a href="datadownload.html#data-american-national-election-study-anesr"><i class="fa fa-check"></i><b>5.5</b> Data: American National Election Study (<code>anesr</code>)</a></li>
<li class="chapter" data-level="5.6" data-path="datadownload.html"><a href="datadownload.html#data-manifesto-project-dataset-manifestor"><i class="fa fa-check"></i><b>5.6</b> Data: Manifesto Project Dataset (<code>manifestoR</code>)</a></li>
<li class="chapter" data-level="5.7" data-path="datadownload.html"><a href="datadownload.html#data-varieties-of-democracy-vdem"><i class="fa fa-check"></i><b>5.7</b> Data: Varieties of Democracy (<code>vdem</code>)</a></li>
<li class="chapter" data-level="5.8" data-path="datadownload.html"><a href="datadownload.html#data-world-development-indicators-wdi"><i class="fa fa-check"></i><b>5.8</b> Data: World Development Indicators (<code>WDI</code>)</a></li>
<li class="chapter" data-level="5.9" data-path="datadownload.html"><a href="datadownload.html#data-github-repositories"><i class="fa fa-check"></i><b>5.9</b> Data: GitHub repositories</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="create.html"><a href="create.html"><i class="fa fa-check"></i><b>6</b> Create data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="create.html"><a href="create.html#create-data-from-files"><i class="fa fa-check"></i><b>6.1</b> Create data from files</a></li>
<li class="chapter" data-level="6.2" data-path="create.html"><a href="create.html#scrape-data-from-tables"><i class="fa fa-check"></i><b>6.2</b> Scrape data from tables</a></li>
<li class="chapter" data-level="6.3" data-path="create.html"><a href="create.html#scrape-political-speeches"><i class="fa fa-check"></i><b>6.3</b> Scrape political speeches</a></li>
<li class="chapter" data-level="6.4" data-path="create.html"><a href="create.html#get-data-from-twitter"><i class="fa fa-check"></i><b>6.4</b> Get data from Twitter</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="create.html"><a href="create.html#data-on-twitter-user"><i class="fa fa-check"></i><b>6.4.1</b> Data on Twitter user</a></li>
<li class="chapter" data-level="6.4.2" data-path="create.html"><a href="create.html#data-on-trends"><i class="fa fa-check"></i><b>6.4.2</b> Data on trends</a></li>
<li class="chapter" data-level="6.4.3" data-path="create.html"><a href="create.html#data-on-tweets"><i class="fa fa-check"></i><b>6.4.3</b> Data on tweets</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="create.html"><a href="create.html#get-data-from-wikipedia"><i class="fa fa-check"></i><b>6.5</b> Get data from Wikipedia</a></li>
</ul></li>
<li class="part"><span><b>II Data visualisation</b></span></li>
<li class="chapter" data-level="7" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>7</b> Introduction to <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="dataviz.html"><a href="dataviz.html#the-basics-of-ggplot2"><i class="fa fa-check"></i><b>7.1</b> The basics of <code>ggplot2</code></a></li>
<li class="chapter" data-level="7.2" data-path="dataviz.html"><a href="dataviz.html#data-1"><i class="fa fa-check"></i><b>7.2</b> Data</a></li>
<li class="chapter" data-level="7.3" data-path="dataviz.html"><a href="dataviz.html#aesthetics"><i class="fa fa-check"></i><b>7.3</b> Aesthetics</a></li>
<li class="chapter" data-level="7.4" data-path="dataviz.html"><a href="dataviz.html#geometric-objects"><i class="fa fa-check"></i><b>7.4</b> Geometric objects</a></li>
<li class="chapter" data-level="7.5" data-path="dataviz.html"><a href="dataviz.html#theme-adjustments"><i class="fa fa-check"></i><b>7.5</b> Theme adjustments</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="presenting-distributions.html"><a href="presenting-distributions.html"><i class="fa fa-check"></i><b>8</b> Presenting distributions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="presenting-distributions.html"><a href="presenting-distributions.html#bar-plot"><i class="fa fa-check"></i><b>8.1</b> Bar plot</a></li>
<li class="chapter" data-level="8.2" data-path="presenting-distributions.html"><a href="presenting-distributions.html#histograms"><i class="fa fa-check"></i><b>8.2</b> Histograms</a></li>
<li class="chapter" data-level="8.3" data-path="presenting-distributions.html"><a href="presenting-distributions.html#density-plots"><i class="fa fa-check"></i><b>8.3</b> Density plots</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="presenting-relationships.html"><a href="presenting-relationships.html"><i class="fa fa-check"></i><b>9</b> Presenting relationships</a>
<ul>
<li class="chapter" data-level="9.1" data-path="presenting-relationships.html"><a href="presenting-relationships.html#box-plot"><i class="fa fa-check"></i><b>9.1</b> Box plot</a></li>
<li class="chapter" data-level="9.2" data-path="presenting-relationships.html"><a href="presenting-relationships.html#scatter-plots"><i class="fa fa-check"></i><b>9.2</b> Scatter plots</a></li>
<li class="chapter" data-level="9.3" data-path="presenting-relationships.html"><a href="presenting-relationships.html#line-plots"><i class="fa fa-check"></i><b>9.3</b> Line plots</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="manipulating-plots.html"><a href="manipulating-plots.html"><i class="fa fa-check"></i><b>10</b> Manipulating plots</a>
<ul>
<li class="chapter" data-level="10.1" data-path="manipulating-plots.html"><a href="manipulating-plots.html#themes"><i class="fa fa-check"></i><b>10.1</b> Themes</a></li>
<li class="chapter" data-level="10.2" data-path="manipulating-plots.html"><a href="manipulating-plots.html#colours"><i class="fa fa-check"></i><b>10.2</b> Colours</a></li>
<li class="chapter" data-level="10.3" data-path="manipulating-plots.html"><a href="manipulating-plots.html#labels"><i class="fa fa-check"></i><b>10.3</b> Labels</a></li>
<li class="chapter" data-level="10.4" data-path="manipulating-plots.html"><a href="manipulating-plots.html#axes"><i class="fa fa-check"></i><b>10.4</b> Axes</a></li>
<li class="chapter" data-level="10.5" data-path="manipulating-plots.html"><a href="manipulating-plots.html#confidence-intervals"><i class="fa fa-check"></i><b>10.5</b> Confidence intervals</a></li>
<li class="chapter" data-level="10.6" data-path="manipulating-plots.html"><a href="manipulating-plots.html#making-multiple-plots-in-one"><i class="fa fa-check"></i><b>10.6</b> Making multiple plots in one</a></li>
<li class="chapter" data-level="10.7" data-path="manipulating-plots.html"><a href="manipulating-plots.html#saving-plots"><i class="fa fa-check"></i><b>10.7</b> Saving plots</a></li>
</ul></li>
<li class="part"><span><b>III Regression</b></span></li>
<li class="chapter" data-level="11" data-path="olsreg.html"><a href="olsreg.html"><i class="fa fa-check"></i><b>11</b> OLS regression</a>
<ul>
<li class="chapter" data-level="11.1" data-path="olsreg.html"><a href="olsreg.html#bivariate-linear-regression"><i class="fa fa-check"></i><b>11.1</b> Bivariate linear regression</a></li>
<li class="chapter" data-level="11.2" data-path="olsreg.html"><a href="olsreg.html#multiple-linear-regression"><i class="fa fa-check"></i><b>11.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="11.3" data-path="olsreg.html"><a href="olsreg.html#saving-predictions"><i class="fa fa-check"></i><b>11.3</b> Saving predictions</a></li>
<li class="chapter" data-level="11.4" data-path="olsreg.html"><a href="olsreg.html#diagnostic-tests"><i class="fa fa-check"></i><b>11.4</b> Diagnostic tests</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>12</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="glm.html"><a href="glm.html#binary-outcomes"><i class="fa fa-check"></i><b>12.1</b> Binary outcomes</a></li>
<li class="chapter" data-level="12.2" data-path="glm.html"><a href="glm.html#other-models"><i class="fa fa-check"></i><b>12.2</b> Other models</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="glm.html"><a href="glm.html#event-count"><i class="fa fa-check"></i><b>12.2.1</b> Event count</a></li>
<li class="chapter" data-level="12.2.2" data-path="glm.html"><a href="glm.html#negative-binomial-regression"><i class="fa fa-check"></i><b>12.2.2</b> Negative binomial regression</a></li>
<li class="chapter" data-level="12.2.3" data-path="glm.html"><a href="glm.html#ordinal-outcomes"><i class="fa fa-check"></i><b>12.2.3</b> Ordinal outcomes</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Presentation</b></span></li>
<li class="chapter" data-level="13" data-path="writing.html"><a href="writing.html"><i class="fa fa-check"></i><b>13</b> Writing</a>
<ul>
<li class="chapter" data-level="13.1" data-path="writing.html"><a href="writing.html#equations"><i class="fa fa-check"></i><b>13.1</b> Equations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>14</b> Tables</a>
<ul>
<li class="chapter" data-level="14.1" data-path="tables.html"><a href="tables.html#regression-tables"><i class="fa fa-check"></i><b>14.1</b> Regression tables</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="tables.html"><a href="tables.html#exporting-the-regression-table"><i class="fa fa-check"></i><b>14.1.1</b> Exporting the regression table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Politics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data management</h1>
<p>There are multiple ways to manage data in <code>R</code> and in particular different ways to create and change variables in a data frame. In this chapter, we show different ways of working with data frames with a focus on how to change and create new variables. Noteworthy, there are multiple packages we can use to manipulate data frames, but the best is without a doubt <code>dplyr</code> <span class="citation">(Hadley Wickham &amp; Francois, 2016)</span>. This is part of the <code>tidyverse</code> package so you do not need to install any new packages if you have already installed <code>tidyverse</code>. The syntax is inspired by SQL and if you want to learn SQL at some point, you will have an advantage from having used the <code>dplyr</code> package.</p>
<p>The package provides some basic functions making it easy to work with data frames. These functions include
<code>select()</code>, <code>filter()</code>, <code>arrange()</code>, <code>rename()</code>, <code>mutate()</code> and <code>summarize()</code>.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> <code>select()</code> allows you to pick variables by their names. <code>filter()</code> allows you to pick observations by their values. <code>arrange()</code> allows you to reorder the rows. <code>rename()</code> allows you to rename columns. <code>mutate()</code> allows you to create new variables based on the values of old variables. <code>summarize()</code> allows you to collapse many values to a single summary.</p>
<p>All these functions rely on data frames. In other words, you can not use these functions on other types of data in <code>R</code>. Furthermore, they all return a new data frame that you will need to save in a new object or overwrite the existing object with your data frame.</p>
<p>As the <code>dplyr</code> package is part of the <code>tidyverse</code>, the first thing we do is to call the <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="data.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>We will use the dataset we created in the previous chapter. If you do not have it, you can use the script below to create the data frame again.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="data.html#cb120-1" aria-hidden="true" tabindex="-1"></a>party <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Conservative Party&quot;</span>, <span class="st">&quot;Labour Party&quot;</span>, <span class="st">&quot;Scottish National Party&quot;</span>, </span>
<span id="cb120-2"><a href="data.html#cb120-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Liberal Democrats&quot;</span>, <span class="st">&quot;Democratic Unionist Party&quot;</span>, <span class="st">&quot;Sinn FÃ©in&quot;</span>) </span>
<span id="cb120-3"><a href="data.html#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="data.html#cb120-4" aria-hidden="true" tabindex="-1"></a>leader <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Theresa May&quot;</span>, <span class="st">&quot;Jeremy Corbyn&quot;</span>, <span class="st">&quot;Nicola Sturgeon&quot;</span>, </span>
<span id="cb120-5"><a href="data.html#cb120-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Tim Farron&quot;</span>, <span class="st">&quot;Arlene Foster&quot;</span>, <span class="st">&quot;Gerry Adams&quot;</span>)</span>
<span id="cb120-6"><a href="data.html#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="data.html#cb120-7" aria-hidden="true" tabindex="-1"></a>votes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">42.4</span>, <span class="fl">40.0</span>, <span class="fl">3.0</span>, <span class="fl">7.4</span>, <span class="fl">0.9</span>, <span class="fl">0.7</span>)</span>
<span id="cb120-8"><a href="data.html#cb120-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-9"><a href="data.html#cb120-9" aria-hidden="true" tabindex="-1"></a>seats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">317</span>, <span class="dv">262</span>, <span class="dv">35</span>, <span class="dv">12</span>, <span class="dv">10</span>, <span class="dv">7</span>)</span>
<span id="cb120-10"><a href="data.html#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="data.html#cb120-11" aria-hidden="true" tabindex="-1"></a>seats_change <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">13</span>, <span class="dv">30</span>, <span class="sc">-</span><span class="dv">21</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb120-12"><a href="data.html#cb120-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-13"><a href="data.html#cb120-13" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(party, leader, votes, seats, seats_change)</span></code></pre></div>
<p>To see the information in the dataset, use <code>head()</code>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="data.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uk2017)</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1        Conservative Party     Theresa May  42.4   317          -13
## 2              Labour Party   Jeremy Corbyn  40.0   262           30
## 3   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 4         Liberal Democrats      Tim Farron   7.4    12            4
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3</code></pre>
<div id="selecting-variables-select" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Selecting variables: <code>select()</code></h2>
<p>When we work with large datasets, we often want to select the few variables that are of key interest to our project. For this task the <code>select()</code> function is perfect. If we only want to have information on the party name and the votes in the <code>uk2017</code> data frame, we can write:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="data.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(uk2017, party, votes)</span></code></pre></div>
<pre><code>##                       party votes
## 1        Conservative Party  42.4
## 2              Labour Party  40.0
## 3   Scottish National Party   3.0
## 4         Liberal Democrats   7.4
## 5 Democratic Unionist Party   0.9
## 6                 Sinn FÃ©in   0.7</code></pre>
<p>Again, this is not saved in a new data frame. If we want to save this in a new data frame, say <code>uk2017_pv</code>, we need to assign the output from <code>select()</code> to our object.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="data.html#cb125-1" aria-hidden="true" tabindex="-1"></a>uk2017_pv <span class="ot">&lt;-</span> <span class="fu">select</span>(uk2017, party, votes)</span></code></pre></div>
<p>There are multiple different functions that can help us find specific variables in the data frame. We can use <code>contains()</code>, if we want to include variables that contain a specific word in the variable name. In the example below we look for variables that contain the text <code>seat</code>.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(uk2017, <span class="fu">contains</span>(<span class="st">&quot;seat&quot;</span>))</span></code></pre></div>
<pre><code>##   seats seats_change
## 1   317          -13
## 2   262           30
## 3    35          -21
## 4    12            4
## 5    10            2
## 6     7            3</code></pre>
<p>Other noteworthy functions similar to <code>contains()</code> that can be of help are functions such as <code>starts_with()</code>, <code>ends_with()</code>, <code>matches()</code>, <code>num_range()</code>, <code>one_of()</code> and <code>everything()</code>. The last function, <code>everything()</code> is helpful if we want to move a variable to the beginning of our data frame.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="data.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(uk2017, votes, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>##   votes                     party          leader seats seats_change
## 1  42.4        Conservative Party     Theresa May   317          -13
## 2  40.0              Labour Party   Jeremy Corbyn   262           30
## 3   3.0   Scottish National Party Nicola Sturgeon    35          -21
## 4   7.4         Liberal Democrats      Tim Farron    12            4
## 5   0.9 Democratic Unionist Party   Arlene Foster    10            2
## 6   0.7                 Sinn FÃ©in     Gerry Adams     7            3</code></pre>
<p>We can use the negative sign if we want to remove a variable from the data frame.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="data.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(uk2017, <span class="sc">-</span>leader)</span></code></pre></div>
<pre><code>##                       party votes seats seats_change
## 1        Conservative Party  42.4   317          -13
## 2              Labour Party  40.0   262           30
## 3   Scottish National Party   3.0    35          -21
## 4         Liberal Democrats   7.4    12            4
## 5 Democratic Unionist Party   0.9    10            2
## 6                 Sinn FÃ©in   0.7     7            3</code></pre>
<p>Last, we can add the function <code>where()</code> if we only want variables of a specific type, e.g.Â only the variables that have characters.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="data.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(uk2017, <span class="fu">where</span>(is.character))</span></code></pre></div>
<pre><code>##                       party          leader
## 1        Conservative Party     Theresa May
## 2              Labour Party   Jeremy Corbyn
## 3   Scottish National Party Nicola Sturgeon
## 4         Liberal Democrats      Tim Farron
## 5 Democratic Unionist Party   Arlene Foster
## 6                 Sinn FÃ©in     Gerry Adams</code></pre>
</div>
<div id="selecting-observations-filter" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Selecting observations: <code>filter()</code></h2>
<p>To select only some of the observations in our data frame, but for all variables, we can use the function <code>filter()</code>. In the example below we select the observations in our data frame with a positive value on <code>seats_change</code> (i.e.Â greater than 0).</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="data.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(uk2017, seats_change <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##                       party        leader votes seats seats_change
## 1              Labour Party Jeremy Corbyn  40.0   262           30
## 2         Liberal Democrats    Tim Farron   7.4    12            4
## 3 Democratic Unionist Party Arlene Foster   0.9    10            2
## 4                 Sinn FÃ©in   Gerry Adams   0.7     7            3</code></pre>
<p>Importantly, we are <em>not</em> making any changes to the data frame <code>uk2017</code>. Again, this will only hapen if we replace our existing data frame or create a new data frame. In the example below we create a new data frame, <code>uk2017_seatlosers</code>, with the observations losing seats from 2015 to 2017.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="data.html#cb136-1" aria-hidden="true" tabindex="-1"></a>uk2017_seatlosers <span class="ot">&lt;-</span> <span class="fu">filter</span>(uk2017, seats_change <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb136-2"><a href="data.html#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="data.html#cb136-3" aria-hidden="true" tabindex="-1"></a>uk2017_seatlosers</span></code></pre></div>
<pre><code>##                     party          leader votes seats seats_change
## 1      Conservative Party     Theresa May  42.4   317          -13
## 2 Scottish National Party Nicola Sturgeon   3.0    35          -21</code></pre>
<p>Next, we can add the function <code>between()</code> to get observations between two values. For example, we can get the parties with more than 5 seats but less than 40 seats.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="data.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(uk2017, <span class="fu">between</span>(seats, <span class="dv">5</span>, <span class="dv">40</span>))</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 2         Liberal Democrats      Tim Farron   7.4    12            4
## 3 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 4                 Sinn FÃ©in     Gerry Adams   0.7     7            3</code></pre>
<p>If we want to select two parties, say the Conservative Party and the Labour Party, we can use <code>%in%</code> to specify this.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="data.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(uk2017, party <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Conservative Party&quot;</span>, <span class="st">&quot;Labour Party&quot;</span>))</span></code></pre></div>
<pre><code>##                party        leader votes seats seats_change
## 1 Conservative Party   Theresa May  42.4   317          -13
## 2       Labour Party Jeremy Corbyn  40.0   262           30</code></pre>
<p>Similarly, by adding an <code>!</code> in front of <code>party</code> we can get the parties that are not the Conservative Party and the Labour Party.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="data.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(uk2017, <span class="sc">!</span>party <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Conservative Party&quot;</span>, <span class="st">&quot;Labour Party&quot;</span>))</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 2         Liberal Democrats      Tim Farron   7.4    12            4
## 3 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 4                 Sinn FÃ©in     Gerry Adams   0.7     7            3</code></pre>
<p>Last, if we want to drop observations that contain missing values on specific variables, we can use the function <code>drop_na()</code>.</p>
</div>
<div id="sorting-observations-arrange" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Sorting observations: <code>arrange()</code></h2>
<p>We can use the function <code>arrange()</code> if we want to change the order of observations. In the example below we sort our data frame according to how many votes the party got, with the party getting the least votes in the top of our data frame.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="data.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(uk2017, votes)</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1                 Sinn FÃ©in     Gerry Adams   0.7     7            3
## 2 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 3   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 4         Liberal Democrats      Tim Farron   7.4    12            4
## 5              Labour Party   Jeremy Corbyn  40.0   262           30
## 6        Conservative Party     Theresa May  42.4   317          -13</code></pre>
<p>If we prefer to have the parties with the greatest number of votes in the top, we can use the negative sign (<code>-</code>).</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="data.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(uk2017, <span class="sc">-</span>votes)</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1        Conservative Party     Theresa May  42.4   317          -13
## 2              Labour Party   Jeremy Corbyn  40.0   262           30
## 3         Liberal Democrats      Tim Farron   7.4    12            4
## 4   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3</code></pre>
<p>Alternatively, you can use the <code>desc()</code> function.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="data.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(uk2017, <span class="fu">desc</span>(votes))</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1        Conservative Party     Theresa May  42.4   317          -13
## 2              Labour Party   Jeremy Corbyn  40.0   262           30
## 3         Liberal Democrats      Tim Farron   7.4    12            4
## 4   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3</code></pre>
</div>
<div id="rename-variables-rename" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Rename variables: <code>rename()</code></h2>
<p>In the case that we have a variable we would prefer having another name, we can use the function <code>rename()</code>. In the example below we change the name of <code>party</code> to <code>party_name</code>.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="data.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(uk2017, <span class="at">party_name =</span> party)</span></code></pre></div>
<pre><code>##                  party_name          leader votes seats seats_change
## 1        Conservative Party     Theresa May  42.4   317          -13
## 2              Labour Party   Jeremy Corbyn  40.0   262           30
## 3   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 4         Liberal Democrats      Tim Farron   7.4    12            4
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3</code></pre>
</div>
<div id="create-variables-mutate" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Create variables: <code>mutate()</code></h2>
<p>The best way to create a new variable from existing variables in our data frame is to use the function <code>mutate()</code>. In the example below we create a new variable, <code>votes_m</code> with information on how many percentage points a party is from the average number of votes a party got in the election.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="data.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(uk2017, <span class="at">votes_m =</span> votes <span class="sc">-</span> <span class="fu">mean</span>(votes))</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change    votes_m
## 1        Conservative Party     Theresa May  42.4   317          -13  26.666667
## 2              Labour Party   Jeremy Corbyn  40.0   262           30  24.266667
## 3   Scottish National Party Nicola Sturgeon   3.0    35          -21 -12.733333
## 4         Liberal Democrats      Tim Farron   7.4    12            4  -8.333333
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2 -14.833333
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3 -15.033333</code></pre>
<p>We can also use the <code>sum()</code> function to find the proportion of seats a party got in a variable, <code>seats_prop</code>.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="data.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(uk2017, <span class="at">seats_prop =</span> seats <span class="sc">/</span> <span class="fu">sum</span>(seats))</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change seats_prop
## 1        Conservative Party     Theresa May  42.4   317          -13 0.49300156
## 2              Labour Party   Jeremy Corbyn  40.0   262           30 0.40746501
## 3   Scottish National Party Nicola Sturgeon   3.0    35          -21 0.05443235
## 4         Liberal Democrats      Tim Farron   7.4    12            4 0.01866252
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2 0.01555210
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3 0.01088647</code></pre>
</div>
<div id="the-pipe-operator" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> The pipe operator: <code>%&gt;%</code></h2>
<p>So far we have looked at a series of different functions. In most cases we want to combine these functions, e.g.Â when we both have to select specific variables and observations. Luckikly, there is nothing against using one function nested within another, as the example below shows.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="data.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">select</span>(uk2017, party, votes), seats_change <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##                       party votes
## 1              Labour Party  40.0
## 2         Liberal Democrats   7.4
## 3 Democratic Unionist Party   0.9
## 4                 Sinn FÃ©in   0.7</code></pre>
<p>The problem is that it can be complicated to read, especially as the number of functions we use increases. Furthermore, the likelihood of making a stupid mistake, e.g.Â by including an extra <code>(</code> or <code>)</code> increases substantially. We can use the pipe operator, <code>%&gt;%</code>, to make our code more readable.</p>
<p>The operator relies on a step-wise logic so we first specify the data frame and then a line for each function we want to run on the data frame.</p>
<p>In the example below we do the same as above but in a way that is easier to follow.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="data.html#cb158-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb158-2"><a href="data.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party, votes) <span class="sc">%&gt;%</span></span>
<span id="cb158-3"><a href="data.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##                       party votes
## 1              Labour Party  40.0
## 2         Liberal Democrats   7.4
## 3 Democratic Unionist Party   0.9
## 4                 Sinn FÃ©in   0.7</code></pre>
<p>On the first line, we show that we are using the data frame <code>uk2017</code>. We end this line with <code>%&gt;%</code>, telling <code>R</code> that we are not done yet but will have to put this into the function on the line below. The next line uses the input from the previous line and selects <code>party</code> and <code>votes</code> from the data frame. This line also ends with the pipe, <code>%&gt;%</code>. The third line shows the observations in our data frame where <code>seats_change</code> is greater than 0. Note that we did not select <code>seats_change</code> as a variable with <code>select()</code>, so this is not crucial in order to use it (as long as it is in the <code>uk2017</code> data frame). Last, we do <em>not</em> end with a pipe as we are done and do not want to do more to our data frame.</p>
<p>If we want to change the names of our variables, we can use <code>setNames()</code>.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="data.html#cb160-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="data.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb160-3"><a href="data.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(party, votes) <span class="sc">%&gt;%</span></span>
<span id="cb160-4"><a href="data.html#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;party_name&quot;</span>, <span class="st">&quot;vote_share&quot;</span>))</span></code></pre></div>
<pre><code>##                  party_name vote_share
## 1              Labour Party       40.0
## 2         Liberal Democrats        7.4
## 3 Democratic Unionist Party        0.9
## 4                 Sinn FÃ©in        0.7</code></pre>
<p>Hopefully, you will soon be using the pipe operator a lot. Instead of having to type <code>&gt;</code>, <code>%</code> and <code>&gt;</code> again and again, there are good shortcuts available in RStudio to create the pipe, specifically Ctrl+Shift+M (Windows) and Cmd+Shift+M (Mac).</p>
<p>Last, if you want to get information on what happens at the individual steps, you can install the <code>tidylog</code> package. This package adds information on what each <code>dplyr</code> function does. In the example below we use <code>select()</code> and <code>filter()</code> with <code>tidylog</code>.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="data.html#cb162-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="data.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  tidylog<span class="sc">::</span><span class="fu">select</span>(party, votes) <span class="sc">%&gt;%</span></span>
<span id="cb162-3"><a href="data.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  tidylog<span class="sc">::</span><span class="fu">filter</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## select: dropped 3 variables (leader, seats, seats_change)</code></pre>
<pre><code>## filter: removed 2 rows (33%), 4 rows remaining</code></pre>
<pre><code>##                       party votes
## 1              Labour Party  40.0
## 2         Liberal Democrats   7.4
## 3 Democratic Unionist Party   0.9
## 4                 Sinn FÃ©in   0.7</code></pre>
<p>We can see that we dropped 3 variables with <code>select()</code> and removed 2 out of 6 rows with <code>filter()</code>. If you prefer to get all this information for all your code, you can include <code>library("tidylog")</code> in your script (<em>after</em> you have loaded the <code>tidyverse</code> package).</p>
</div>
<div id="running-functions-on-variables-apply" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Running functions on variables: <code>apply()</code></h2>
<p>If we would like to run a function on some of our rows or columns, we can use the function <code>apply()</code>. For example, we can get the average number of votes and seats for parties with a positive value on <code>seats_change</code> (i.e.Â parties with an increase in seats from 2015 to 2017).</p>
<p>The addition here is the function <code>apply()</code> on the data frame used above. The first thing we specify here is <code>MARGIN</code>, i.e.Â whether we want to run a function on our rows (1) or columns (2). The next thing we specify is the function together with any relevant options.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="data.html#cb166-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span></span>
<span id="cb166-2"><a href="data.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb166-3"><a href="data.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(votes, seats) <span class="sc">%&gt;%</span></span>
<span id="cb166-4"><a href="data.html#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## votes seats 
## 12.25 72.75</code></pre>
<p>In the case you want to apply a function to both rows and columns, you will have to specify <code>c(1, 2)</code>. It is not important to mention <code>MARGIN</code> or <code>FUN</code> if you have the order right. In other words, we can simplify our example to the code below.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="data.html#cb168-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="data.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="data.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(votes, seats) <span class="sc">%&gt;%</span></span>
<span id="cb168-4"><a href="data.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>## votes seats 
## 12.25 72.75</code></pre>
</div>
<div id="aggregating-variables-summarize-and-group_by" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Aggregating variables: <code>summarize()</code> and <code>group_by()</code></h2>
<p>If we want to create new variables with aggregated information, similar to the information we got in the previous section, we can use the function <code>summarize()</code>. In the example below we get a data frame with information on the number of observatins, given by <code>n()</code>, the minimum number of votes a party got (<code>votes_min</code>), the maximum number of votes a party got (<code>votes_max</code>) and the average number of votes a party got (<code>votes_mean</code>) (all in percentages).</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="data.html#cb170-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span></span>
<span id="cb170-2"><a href="data.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">party =</span> <span class="fu">n</span>(), </span>
<span id="cb170-3"><a href="data.html#cb170-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">votes_min =</span> <span class="fu">min</span>(votes), </span>
<span id="cb170-4"><a href="data.html#cb170-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">votes_max =</span> <span class="fu">max</span>(votes), </span>
<span id="cb170-5"><a href="data.html#cb170-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">votes_mean =</span> <span class="fu">mean</span>(votes))</span></code></pre></div>
<pre><code>##   party votes_min votes_max votes_mean
## 1     6       0.7      42.4   15.73333</code></pre>
<p>If we want this information for different groups, we can supply with <code>group_by()</code>. In the example below we get the same information for parties with an increase in seats from 2015 to 2017 and not.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="data.html#cb172-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span></span>
<span id="cb172-2"><a href="data.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb172-3"><a href="data.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">party =</span> <span class="fu">n</span>(), </span>
<span id="cb172-4"><a href="data.html#cb172-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">votes_min =</span> <span class="fu">min</span>(votes), </span>
<span id="cb172-5"><a href="data.html#cb172-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">votes_max =</span> <span class="fu">max</span>(votes), </span>
<span id="cb172-6"><a href="data.html#cb172-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">votes_mean =</span> <span class="fu">mean</span>(votes))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   `seats_change &gt; 0` party votes_min votes_max votes_mean
##   &lt;lgl&gt;              &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 FALSE                  2       3        42.4       22.7
## 2 TRUE                   4       0.7      40         12.2</code></pre>
<p>In the example, you can see the aggregated information. The information next to <code>TRUE</code> is the aggregated information for the observations where <code>seats_change</code> is greater than 0. Last, often you want to conduct additional work on your data frame where it should no longer be grouped anymore. In that case, you can use <code>ungroup()</code>.</p>
</div>
<div id="recoding-variables-case_when" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Recoding variables: <code>case_when()</code></h2>
<p>In a lot of cases we want to recode the information in a single variable. To do this, we can use <code>case_when()</code>. Let us use the <code>leader</code> variable in <code>uk2017</code> as an example.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="data.html#cb174-1" aria-hidden="true" tabindex="-1"></a>uk2017<span class="sc">$</span>leader </span></code></pre></div>
<pre><code>## [1] &quot;Theresa May&quot;     &quot;Jeremy Corbyn&quot;   &quot;Nicola Sturgeon&quot; &quot;Tim Farron&quot;     
## [5] &quot;Arlene Foster&quot;   &quot;Gerry Adams&quot;</code></pre>
<p>In the case that we want to create a new leader variable (in this example called <code>leader_new</code>) where Theresa May is replaced with Boris Johnson, we can do that with the code below.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="data.html#cb176-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="data.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">leader_new =</span> <span class="fu">case_when</span>(</span>
<span id="cb176-3"><a href="data.html#cb176-3" aria-hidden="true" tabindex="-1"></a>    leader <span class="sc">==</span> <span class="st">&quot;Theresa May&quot;</span> <span class="sc">~</span> <span class="st">&quot;Boris Johnson&quot;</span>, </span>
<span id="cb176-4"><a href="data.html#cb176-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(leader))</span>
<span id="cb176-5"><a href="data.html#cb176-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1        Conservative Party     Theresa May  42.4   317          -13
## 2              Labour Party   Jeremy Corbyn  40.0   262           30
## 3   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 4         Liberal Democrats      Tim Farron   7.4    12            4
## 5 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 6                 Sinn FÃ©in     Gerry Adams   0.7     7            3
##        leader_new
## 1   Boris Johnson
## 2   Jeremy Corbyn
## 3 Nicola Sturgeon
## 4      Tim Farron
## 5   Arlene Foster
## 6     Gerry Adams</code></pre>
<p>Using <code>case_when()</code> is a great way to make recodings easily. As you can see, you first specify what condition a variable should satisfy, before you use <code>~</code> to tell what the new variable in mutate should be for this variable. At the end, we use <code>TRUE</code> to specify what all other values on the variable should be (in this example the other leaders in our variable).</p>
<p>Noteworthy, we do not save the <code>leader_new</code> variable in our data frame. If we want to save the changes, we can save the new variable to our data frame with the code below.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="data.html#cb178-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="ot">&lt;-</span> uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb178-2"><a href="data.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">leader_new =</span> <span class="fu">case_when</span>(</span>
<span id="cb178-3"><a href="data.html#cb178-3" aria-hidden="true" tabindex="-1"></a>    leader <span class="sc">==</span> <span class="st">&quot;Theresa May&quot;</span> <span class="sc">~</span> <span class="st">&quot;Boris Johnson&quot;</span>, </span>
<span id="cb178-4"><a href="data.html#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(leader))</span>
<span id="cb178-5"><a href="data.html#cb178-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p><code>dplyr</code> in the <code>tidyverse</code> also has a <code>recode()</code> function, and the <code>car</code> package <span class="citation">(Fox &amp; Weisberg, 2011)</span> has a similar function worth exploring. However, it is recommended that you stick with <code>mutate()</code> and <code>case_when()</code>.</p>
</div>
<div id="choosing-rows-by-position-slice" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Choosing rows by position: <code>slice()</code></h2>
<p>If you only want to use specific rows with a specific position in your data, you can use <code>slice()</code> and specify the number of observations, you would like to get. In the example below, we specify that we would like the first three observations and the sixth observation.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="data.html#cb179-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="data.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>##                     party          leader votes seats seats_change
## 1      Conservative Party     Theresa May  42.4   317          -13
## 2            Labour Party   Jeremy Corbyn  40.0   262           30
## 3 Scottish National Party Nicola Sturgeon   3.0    35          -21
## 4               Sinn FÃ©in     Gerry Adams   0.7     7            3
##        leader_new
## 1   Boris Johnson
## 2   Jeremy Corbyn
## 3 Nicola Sturgeon
## 4     Gerry Adams</code></pre>
<p>This function is also useful if you would like to get the last part of a dataset, say from the third to the last observation. In order to do this, we use <code>n()</code>.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="data.html#cb181-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="data.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>())</span></code></pre></div>
<pre><code>##                       party          leader votes seats seats_change
## 1   Scottish National Party Nicola Sturgeon   3.0    35          -21
## 2         Liberal Democrats      Tim Farron   7.4    12            4
## 3 Democratic Unionist Party   Arlene Foster   0.9    10            2
## 4                 Sinn FÃ©in     Gerry Adams   0.7     7            3
##        leader_new
## 1 Nicola Sturgeon
## 2      Tim Farron
## 3   Arlene Foster
## 4     Gerry Adams</code></pre>
</div>
<div id="getting-a-variable-from-a-data-frame-pull" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Getting a variable from a data frame: <code>pull()</code></h2>
<p>Often you do something to a data frame but might be interested in just working with one variable within that data frame. To do this, <code>pull()</code> is a great function. Letâs say we want to get the average votes for parties with a positive value on <code>seats_changes</code>. Here, we first use <code>filter()</code> to get the observations we want to look at and then use <code>pull()</code> with the <code>votes</code> variable to use <code>mean()</code> on this variable</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="data.html#cb183-1" aria-hidden="true" tabindex="-1"></a>uk2017 <span class="sc">%&gt;%</span> </span>
<span id="cb183-2"><a href="data.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seats_change <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb183-3"><a href="data.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(votes) <span class="sc">%&gt;%</span> </span>
<span id="cb183-4"><a href="data.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 12.25</code></pre>
<p>Here, we can see that the average support for parties with a positive value on <code>seats_change</code> is 12.25.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p>For another good introduction to <code>dplyr</code>, see: <a href="https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html">Managing Data Frames with the dplyr package</a>.<a href="data.html#fnref7" class="footnote-back">â©ï¸</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="text.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["qpolr.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
